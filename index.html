<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">

    <meta name="description" content="pamatcher is a pattern matching library for JavaScript iterators that generalizes the notion of regular expression.">
    <meta name="keywords" content="JavaScript, library, pattern, matching, iterators, iterable, regex">
    <title>pamatcher - A pattern matching library for JavaScript iterators</title>

    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/theme/base16-dark.min.css">
    <link rel="stylesheet" href="stylesheets/styles.css">

    <script src="https://jspm.io/system@0.19.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.7.0/mode/javascript/javascript.min.js"></script>
    <script>
    $(function() {
      $("#main textarea.code.readonly").each(function() {
        CodeMirror.fromTextArea(this, {
          readOnly: true,
          mode: "javascript",
          theme: "base16-dark"
        });
      });

      $("#main textarea.shell.readonly").each(function() {
        CodeMirror.fromTextArea(this, {
          readOnly: true,
          mode: "shell",
          theme: "base16-dark"
        });
      });

      if(screen.width < 950) {
        $(window).scroll(function() {
          if ($(this).scrollTop()>0) {
            $('.github-corner').hide();
           } else {
            $('.github-corner').show();
           }
         });
     } else {
       System.import('npm:pamatcher').then(function(pamatcher) {
          var inputEditor = CodeMirror.fromTextArea($("#input-area")[0], {
            mode: "javascript",
            theme: "base16-dark"
          });

          var patternEditor = CodeMirror.fromTextArea($("#pattern-area")[0], {
            mode: "javascript",
            theme: "base16-dark"
          });

          var resultEditor = CodeMirror.fromTextArea($("#result-area")[0], {
            readOnly: true,
            mode: null,
            theme: "base16-dark"
          });

          inputEditor.on("change", function() {
            resultEditor.getDoc().setValue('');
          });

          patternEditor.on("change", function() {
            resultEditor.getDoc().setValue('');
          });

          $("#test").click((e) => {
            var pattern = eval(patternEditor.getValue());
            var input = eval(inputEditor.getValue());

            var matcher = pamatcher(pattern);
            var result = matcher.exec(input);
            var output = '';

            if(result.test) {
                output = 'Pattern matches!';
                for(c in result.captures) {
                  output += "\r\n";
                  output += c + ": " + result.captures[c];
                }
            } else {
                output = "Pattern doesn't match.";
            }
            resultEditor.getDoc().setValue(output);
          }); // click #test

          $("#try").show();

          patternEditor.refresh();
          inputEditor.refresh();
      }); // import pamatcher
    } // resolution
    });
    </script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68852854-1', 'auto');
      ga('send', 'pageview');
    </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <a href="https://github.com/pmros/pamatcher" class="github-corner">
      <svg viewBox="0 0 250 250" style="fill:#fff; color:#151513; position: fixed; top: 0; border: 0; right: 0;">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    </a>

    <div id="container">
      <div id="sidebar">
        <h1>
          <img id="logo" src="images/logo.png" alt="pamatcher">
        </h1>

        <div id="try">

            <fieldset>
              <div id="input">
                <label for='input'>Input</label>
                <textarea class="code js" rows='2' id='input-area'>[1, 4, 8, 44, 55]</textarea>
              </div>
              <div id="pattern">
                <label for='pattern'>Pattern</label>
                <textarea class="code js" rows='4' id='pattern-area'>[
  (i) => i < 10,
  { repeat: (i) => i%2==0,
    name: 'mycatch' },
  (i) => i > 10
]</textarea>
              </div>
              <button id="test">Test</button>
              <div id="result">
                <label for='pattern'>Result</label>
                <div id="result-wrapper">
                  <span id="result-msg"></span>
                </div>
                <textarea id="result-area" rows='2'></textarea>
              </div>
            </fieldset>
        </div>
      </div>


      <div id="main">
        <h2>Overview</h2>
        <p>
        <strong>pamatcher</strong> is a pattern matching library for JavaScript iterators that generalizes the notion of regular expression to any sequence of items of any type. Instead strings, you can use any iterable or iterator as input. Instead of characters you can use any predicate as item matcher. So you can do pattern matching in a general and declarative way.
        </p>
        <h2>Installation and usage</h2>
        <p>You can install pamatcher using npm:</p>
        <textarea class="shell readonly auto">npm install pamatcher</textarea>
        <p>This is an example of use:</p>
        <textarea class="code readonly auto">
var pamatcher = require('pamatcher');

var matcher = pamatcher(
  (i) => i < 10,
  { repeat: (i) => i%2==0, name: 'mycatch' },
  (i) => i > 10
);

var result = matcher.exec(input);
if(result.test) {
  console.log("Pattern matches!");
  console.log("Captured values: " + result.captures['mycatch'].join(','));
} else {
  console.log("Pattern doesn't match.");
}</textarea>

        <p>In the example, the pattern is simple: match a number lesser than 10, 
        followed by zero or more even numbers and finally a number greater than 10. 
        You test an array and it should print "Pattern matches!".</p>

        <p>If you want to use pamatcher from browser, you can use <a href="http://jspm.io/">jspm</a>. 
        Here you have a complete pamatcher demo for browser at <a href="https://gist.github.com/pmros/137ecf2351e0f2fe44d4">gist</a> 
        (or live at <a href="http://bl.ocks.org/pmros/137ecf2351e0f2fe44d4">bl.ocks.org</a>).</p>
        
        <h2>API</h2>

        <h3>pamatcher(expression)</h3>

        <p>This is a function that transforms a pattern expression into a <a href="#matcher-object">matcher</a>. 
        This is the only thing you need to import/require to use pamatcher library.</p>

        <p>A pattern expression is a JavaScript object that specify the pattern you want to use. 
        You can add <strong>name</strong> property to any pattern expreession in order to capture a <strong>group</strong>.</p> 
        <p>A pattern expression can be:</p>

        <h4>{ predicate: [function] }</h4>
        <h4>[function]</h4>
        <p>A is a function that takes an input item, evaluates it and return a boolean. True means "item accepted".</p>
        <p>If you pass a function as pattern expression, pamatcher will convert it to a predicate pattern expression for you.</p>

        <h4>{ value: [whatever] }</h4>
        <h4>[whatever]</h4>
        <p>This is a shortcut for a (deep) equality predicate.</p>
        <p>If you pass a value as pattern expression and that value is not an object that looks like a pattern expression,
        a function or an array, then pamatcher will convert it to a value pattern expression for you.</p>
        
        <h4>{ sequence: [array of expressions] }</h4>
        <h4>[array of expressions]</h4>
        <p>A sequence of expressions.
        It's something like this regex:  /abc/</p>
        <p>If you pass an array as pattern expression, pamatcher will convert it to a sequence pattern expression for you.</p>
        <p>In adition, pamatcher function can automatically convert any number of arguments to a sequence expression (see example above).</p>

        <h4>{ or: [array of expressions] }</h4>
        <p>Logical or of multiple expressions.
        It's something like this regex:  /(a|b|c)/</p>

        <h4>{ optional: [expression] }</h4>
        <p>An optional expression.
        It's something like this regex:  /a?/</p>

        <h4>{ repeat: [expression] }</h4>
        <p>A sequence of zero or more expressions repeated.
        It's something like this regex:  /a*/</p>

        <h4>{ repeat: [expression], min: [int], max: [int] }</h4>
        <p>A sequence from <i>min</i> up to <i>max</i> expressions repeated. min and max are optional.
        It's something like this regex: /a{2,5}/</p>

        <h3 id="matcher-object">matcher object</h3>
        <p>A matcher object can check if your expression matches to an input and capture named groups.</p>

        <h4>matcher.test(input)</h4>
        <p>The input is an iterator or an iterable. These are ES6 features. Array, String, Map, Set are iterables.</p>
        <p>test method returns true if your pattern expression matchs your input, otherwise it returns false.</p>

        <h4>matcher.match(input)</h4>
        <p>matcher method returns an object that contains captured values of each named group.</p>

        <h4>matcher.exec(input)</h4>
        <p>exec method returns an object that contains two properties:</p>
        <ul>
          <li><strong>test</strong>: [boolean] true if your pattern expression matchs your input, otherwise it returns false.</li>
          <li><strong>captures</strong>: [object] captured values of each named group.</li>
        </ul>

        <h2>TODO</h2>
        <ul>
          <li><i class="icon-check"></i> Pattern expressions</li>
          <li><i class="icon-check"></i> Browser suport</li>
          <li><i class="icon-check"></i> Cardinality for repeat pattern</li>
          <li><i class="icon-check"></i> Capturing groups</li>
          <li><i class="icon-check-empty"></i> Simple expressions using strings like traditional regular expressions</li>
          <li><i class="icon-check-empty"></i> Error handling</li>
          <li><i class="icon-check-empty"></i> More information avaible for predicates (index, previous item...)</li>
        </ul>
      </div>
    </div>
  </body>
</html>
