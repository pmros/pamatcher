"use strict";(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else{if(typeof module==="object"&&module.exports){module.exports=b()}else{a.k=a.kappa=b()}}})(this,function __init__(){var g={__name__:"kappa",__init__:__init__,__dependencies__:{},__version__:"0.0.1",utils:{},data:{},lexer:{},parser:{},};g.utils.obj=(function(){var C=function(aD,aE){for(var aC in aE){if(aE.hasOwnProperty(aC)){aD[aC]=aE[aC]}}function aB(){this.constructor=aD}aB.prototype=aE.prototype;aD.prototype=new aB()};var u=function(aC,aE,aD){if(!aC||!aE){throw new Error("Invalid property specification. In order to create a property please specify a context and a property name.")}var aB=at({enumerable:true,configurable:false,set:function(aF){aC.options[aE]=aF},get:function(){return aC.options[aE]}},aD||{});Object.defineProperty(aC,aE,aB)};var at=function(aD){var aB=Array.prototype.slice.call(arguments,1);for(var aC=0;aC<aB.length;aC++){if(aB[aC]){for(var aE in aB[aC]){aD[aE]=aB[aC][aE]}}}return aD};var ab=function(aB){return JSON.parse(JSON.stringify(aB))};var au=function(aE){var aC=Array.prototype.slice.call(arguments,1),aB=ab(aE);for(var aD=0;aD<aC.length;aD++){if(aC[aD]){for(var aF in aC[aD]){aB[aF]=aC[aD][aF]}}}return aB};var O=function(aB){return Object.prototype.toString.call(aB)==="[object Array]"};var Q=function(aB){return Object.prototype.toString.call(aB)==="[object String]"};var H=function(aB){return Object.prototype.toString.call(aB)==="[object RegExp]"};var A=function(aB){return Object.prototype.toString.call(aB)==="[object Number]"};var aA=function(aB){return Object.prototype.toString.call(aB)==="[object Function]"};var ak=function(aB){return aB===true||aB===false||Object.prototype.toString.call(aB)==="[object Boolean]"};var X=function(aB){return Object.prototype.toString.call(aB)==="[object Arguments]"};if(!X(arguments)){X=function(aB){return !!(aB&&t(aB,"callee"))}}var av=function(aB){return aB===Object(aB)&&!aA(aB)};var v=function(aB){return aB===void 0};var ad={};var ac=Array.prototype,S=ac.concat,ai=ac.push,K=Function.prototype;var x=Object.keys,ax=ac.forEach,af=ac.reduce,ag=K.bind,s=ac.filter,I=ac.some,Y=ac.every,E=ac.indexOf,G=ac.slice;var t=function(aC,aB){return hasOwnProperty.call(aC,aB)};var U=function(aD){if(!av(aD)){return[]}if(x){return x(aD)}var aC=[];for(var aB in aD){if(t(aD,aB)){aC.push(aB)}}return aC};var am=function(aG,aD,aC){if(aG===null){return aG}var aB,aF;if(ax&&aG.forEach===ax){aG.forEach(aD,aC)}else{if(aG.length===+aG.length){for(aB=0,aF=aG.length;aB<aF;aB++){if(aD.call(aC,aG[aB],aB,aG)===ad){return}}}else{var aE=U(aG);for(aB=0,aF=aE.length;aB<aF;aB++){if(aD.call(aC,aG[aE[aB]],aE[aB],aG)===ad){return}}}}return aG};var T=function(aE,aD,aC){var aB=[];if(aE===null){return aB}am(aE,function(aH,aF,aG){aB.push(aD.call(aC,aH,aF,aG))});return aB};var z="Reduce of empty array with no initial value";var az=function(aF,aE,aB,aD){var aC=arguments.length>2;if(aF===null){aF=[]}if(af&&aF.reduce===af){if(aD){aE=w(aE,aD)}return aC?aF.reduce(aE,aB):aF.reduce(aE)}am(aF,function(aI,aG,aH){if(!aC){aB=aI;aC=true}else{aB=aE.call(aD,aB,aI,aG,aH)}});if(!aC){throw new TypeError(z)}return aB};var aa=function(){};var w=function(aE,aC){var aB,aD;if(ag&&aE.bind===ag){return ag.apply(aE,G.call(arguments,1))}if(!aA(aE)){throw new TypeError()}aB=G.call(arguments,2);aD=function(){if(!(this instanceof aD)){return aE.apply(aC,aB.concat(G.call(arguments)))}aa.prototype=aE.prototype;var aG=new aa();aa.prototype=null;var aF=aE.apply(aG,aB.concat(G.call(arguments)));if(Object(aF)===aF){return aF}return aG};return aD};var F=function(aE,aB,aD){var aC=[];if(aE===null){return aC}if(s&&aE.filter===s){return aE.filter(aB,aD)}am(aE,function(aH,aF,aG){if(aB.call(aD,aH,aF,aG)){aC.push(aH)}});return aC};var r=function(aB){return aB};var W=function(aE,aC,aD){aC=aC||r;var aB=false;if(aE===null){return aB}if(I&&aE.some===I){return aE.some(aC,aD)}am(aE,function(aH,aF,aG){if(aB||(aB=aC.call(aD,aH,aF,aG))){return ad}});return !!aB};var aw=function(aC,aB){return T(aC,k(aB))};var k=function(aB){return function(aC){return aC[aB]}};var q=function(aB){if(aB===null||aB===undefined){return r}if(aA(aB)){return aB}return k(aB)};var B=function(aC,aB,aD){if(aB===void 0){return aC}switch(aD===null?3:aD){case 1:return function(aE){return aC.call(aB,aE)};case 2:return function(aF,aE){return aC.call(aB,aF,aE)};case 3:return function(aF,aE,aG){return aC.call(aB,aF,aE,aG)};case 4:return function(aE,aG,aF,aH){return aC.call(aB,aE,aG,aF,aH)}}return function(){return aC.apply(aB,arguments)}};var ay=function(aC,aB,aD){if(aC===null||aC===undefined){return r}if(aA(aC)){return B(aC,aB,aD)}if(av(aC)){return aq(aC)}return k(aC)};var y=function(aD,aC,aB){aC=q(aC);return aw(T(aD,function(aG,aE,aF){return{value:aG,index:aE,criteria:aC.call(aB,aG,aE,aF)}}).sort(function(aH,aG){var aF=aH.criteria;var aE=aG.criteria;if(aF!==aE){if(aF>aE||aF===void 0){return 1}if(aF<aE||aE===void 0){return -1}}return aH.index-aG.index}),"value")};var ah=function(aE,aC,aD){var aB;W(aE,function(aH,aF,aG){if(aC.call(aD,aH,aF,aG)){aB=aH;return true}});return aB};var M=function(aB){return function(aF,aE,aD){var aC={};aE=q(aE);am(aF,function(aI,aG){var aH=aE.call(aD,aI,aG,aF);aB(aC,aH,aI)});return aC}};var ap=function(aE,aC,aD){aC=aC||r;var aB=true;if(aE===null){return aB}if(Y&&aE.every===Y){return aE.every(aC,aD)}am(aE,function(aH,aF,aG){if(!(aB=aB&&aC.call(aD,aH,aF,aG))){return ad}});return !!aB};var R=function(aC,aD,aB){if(aD&&ap(aC,O)){return S.apply(aB,aC)}am(aC,function(aE){if(O(aE)||X(aE)){if(aD){ai.apply(aB,aE)}else{R(aE,aD,aB)}}else{aB.push(aE)}});return aB};var N=function(aC,aB){return R(aC,aB,[])};var aj=function(aC,aB){if(aC===null||aC===undefined){return false}if(E&&aC.indexOf===E){return aC.indexOf(aB)!==-1}return W(aC,function(aD){return aD===aB})};var an=function(aH,aG,aF,aE){if(aA(aG)){aE=aF;aF=aG;aG=false}var aC=aF?T(aH,aF,aE):aH,aD=[],aB=[];am(aC,function(aJ,aI){if(aG?(!aI||aB[aB.length-1]!==aJ):!aj(aB,aJ)){aB.push(aJ);aD.push(aH[aI])}});return aD};var ao=M(function(aB,aC,aD){if(t(aB,aC)){aB[aC].push(aD)}else{aB[aC]=[aD]}});var ar=function(aI,aH,aE,aD){aE=q(aE);var aG=aE.call(aD,aH);var aB=0,aF=aI.length;while(aB<aF){var aC=(aB+aF)>>>1;if(aE.call(aD,aI[aC])<aG){aB=aC+1}else{aF=aC}}return aB};var D=function(aF,aD,aE){if(aF===null){return -1}var aB=0,aC=aF.length;if(aE){if(typeof aE==="number"){aB=(aE<0?Math.max(0,aC+aE):aE)}else{aB=ar(aF,aD);return aF[aB]===aD?aB:-1}}if(E&&aF.indexOf===E){return aF.indexOf(aD,aE)}for(;aB<aC;aB++){if(aF[aB]===aD){return aB}}return -1};var V=0;var J=function(aB){var aC=++V+"";return aB?aB+aC:aC};var L=function(aD,aC,aB){if(aD===null||aD===undefined){return void 0}if(aC===null||aC===undefined||aB){return aD[aD.length-1]}return G.call(aD,Math.max(aD.length-aC,0))};var ae=function(aB){if(!av(aB)){return aB}return O(aB)?aB.slice():at({},aB)};var P=function(aE,aG,aB){var aJ=-Infinity,aH=-Infinity,aI,aD;if((aG===null||aG===undefined)&&aE!==null){aE=aE.length===+aE.length?aE:Z(aE);for(var aF=0,aC=aE.length;aF<aC;aF++){aI=aE[aF];if(aI>aJ){aJ=aI}}}else{aG=ay(aG,aB);am(aE,function(aM,aK,aL){aD=aG(aM,aK,aL);if(aD>aH||aD===-Infinity&&aJ===-Infinity){aJ=aM;aH=aD}})}return aJ};var al=function(aF){var aD=U(aF),aC=aD.length,aE=new Array(aC);for(var aB=0;aB<aC;aB++){aE[aB]=[aD[aB],aF[aD[aB]]]}return aE};var aq=function(aB){var aD=al(aB),aC=aD.length;return function(aG){if(aG===null){return !aC}aG=new Object(aG);for(var aF=0;aF<aC;aF++){var aH=aD[aF],aE=aH[0];if(aH[1]!==aG[aE]||!(aE in aG)){return false}}return true}};var Z=function(aF){var aE=U(aF),aD=aE.length,aB=new Array(aD);for(var aC=0;aC<aD;aC++){aB[aC]=aF[aE[aC]]}return aB};return{inherit:C,extend:at,extendInNew:au,clone:ab,isArray:O,isString:Q,isRegExp:H,isNumber:A,isObject:av,isFunction:aA,isArguments:X,isBoolean:ak,isUndefined:v,keys:U,each:am,map:T,has:t,reduce:az,bind:w,filter:F,any:W,defineProperty:u,pluck:aw,sortBy:y,property:k,find:ah,every:ap,flatten:N,groupBy:ao,contains:aj,uniq:an,sortedIndex:ar,indexOf:D,uniqueId:J,last:L,shallowClone:ae,max:P,pairs:al,matches:aq,values:Z}})();g.utils.str=(function(){var s=function(z){return Object.prototype.toString.call(z)==="[object String]"};var x=function(A,z){return A?String.prototype.slice.call(A,0,z.length)===z:false};var q=function(z){return z.replace(/^\s+|\s+$/g,"")};var t=function(A){var z=/^[ \f\t\v\u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+/;return A.replace(z,"")};var w=function(z){return z.replace(/^[\n\r]+/,"")};var v=function(z){return z.replace(/^\s+/,"")};var y=function(z){return z.replace(/\s+$/,"")};var k=function(z){return z.replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")};var u=function(A){var z="";for(var B=A;B--;){z+="\t"}return z};var r=function(A,F,z){var E=0,C=A.length,B,D=[];if(A===""||!s(A)||!s(F)){return[]}if(!z){F=F.toLowerCase();A=A.toLowerCase()}while((B=F.indexOf(A,E))>-1){D.push(B);E=B+C}return D};return{startsWith:x,trim:q,ltrim:t,ltrimBreaks:w,fullLtrim:v,rtrim:y,fulltrim:k,tabs:u,getIndicesOf:r}})();g.data.Node=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"transitions");g.utils.obj.defineProperty(this,"nodes");g.utils.obj.defineProperty(this,"name");g.utils.obj.defineProperty(this,"_id");this.transitions=q.transitions||[];this.nodes=q.nodes||[]};k.prototype.getIdentity=function(){if(!this._id){this._id=this._generateIdentity()}return this._id};k.prototype._generateIdentity=function(){return this.name||g.utils.obj.uniqueId("node_")};k.prototype.addTransition=function(q,r){this.transitions.push(this._generateNewTransition(q,r));this.nodes.push(r)};k.prototype._generateNewTransition=function(q,r){return{transitionValue:q,node:r}};k.prototype.toString=function(){return this.getIdentity()};return k})();var f=g.data.specialSymbol={EMPTY:"EMPTY",EOF:"EOF"};var n=g.data.associativity={LEFT:"LEFT",RIGHT:"RIGHT"};var j=g.data.Symbol=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"name");g.utils.obj.defineProperty(this,"isSpecial");g.utils.obj.defineProperty(this,"rule");this.isSpecial=g.utils.obj.isBoolean(q.isSpecial)?q.isSpecial:true;if(!this.name||!g.utils.obj.isString(this.name)){throw new Error("Invalid initialization values for a symbol, please provide a string name a symbol")}};k.prototype.toString=function(){return this.name.toString()};return k})();var b=g.data.NonTerminal=(function(q){g.utils.obj.inherit(k,q);function k(r){q.apply(this,arguments);g.utils.obj.defineProperty(this,"isNullable");this.isNullable=false;this.isSpecial=false}k.fromArray=function(s){if(!g.utils.obj.isArray(s)&&!g.utils.obj.isString(s)){throw new Error("Invalid parameter. To create non terminal from array the input parameter should be an array!")}var r=[];g.utils.obj.each(s,function(t){r[r.length]=new b({name:t})});return r};return k})(j);var d=g.data.Terminal=(function(q){g.utils.obj.inherit(k,q);function k(r){if(!g.utils.obj.isString(r.body)&&!g.utils.obj.isRegExp(r.body)){throw new Error("Invalid Terminal Initialization. A string or regexp body must be specified")}r.name=r.name?r.name:r.body.toString();q.apply(this,arguments);g.utils.obj.defineProperty(this,"body");g.utils.obj.defineProperty(this,"isTerminal");g.utils.obj.defineProperty(this,"assoc");g.utils.obj.defineProperty(this,"priority");this.priority=this.priority||0;this.isSpecial=false;this.isTerminal=true}k.prototype.toString=function(){return"<"+this.name+">"};return k})(j);var c=g.data.Rule=(function(){var k=function(q){this.options=q;if(!q.head){throw new Error("Invalid initialization values, please provide a head for the rule")}g.utils.obj.defineProperty(this,"head");g.utils.obj.defineProperty(this,"tail");g.utils.obj.defineProperty(this,"reduceFunc");g.utils.obj.defineProperty(this,"name");g.utils.obj.defineProperty(this,"precendence");g.utils.obj.defineProperty(this,"index");g.utils.obj.defineProperty(this,"isProductive");g.utils.obj.defineProperty(this,"isReachable");g.utils.obj.defineProperty(this,"terminalsCount");this.index=-1;this.isProductive=false;this.isReachable=false;this.terminalsCount=0;this.head=!(q.head instanceof b)?new b({name:q.head.toString()}):q.head;this.tail=(q.tail&&g.utils.obj.isArray(q.tail))?q.tail:[new j({name:f.EMPTY,isSpecial:true})];g.utils.obj.each(this.tail,function(r){if(r instanceof d){this.terminalsCount++}},this)};k.prototype.toString=function(){return this.head.toString()+" --> "+this.tail.join(" ")};return k})();var i=g.data.Grammar=(function(){var q={name:""};var k=function(r){this.options=g.utils.obj.extendInNew(q,r||{});g.utils.obj.defineProperty(this,"startSymbol");g.utils.obj.defineProperty(this,"name");g.utils.obj.defineProperty(this,"rules");g.utils.obj.defineProperty(this,"preserveNonProductiveRules");g.utils.obj.defineProperty(this,"preserveUnReachableRules");g.utils.obj.defineProperty(this,"specifiedStartSymbol");g.utils.obj.defineProperty(this,"terminals");g.utils.obj.defineProperty(this,"rulesByHeader");g.utils.obj.defineProperty(this,"firstSetsByHeader");g.utils.obj.defineProperty(this,"nullableNonTerminals");if(!(this.startSymbol instanceof j)){throw new Error("Invalid grammar creation, please specify a start Symbol!")}this.nullableNonTerminals=[];this._generateRequireRequisites()};k.constants={AugmentedRuleName:"AUGMENTRULE"};k.prototype._isRuleProductive=function(r){return !g.utils.obj.find(r.tail,function(s){if(s instanceof b&&((this.rulesByHeader[s.name]&&g.utils.obj.every(this.rulesByHeader[s.name],function(t){return !t.isProductive}))||(!this.rulesByHeader[s.name]))){return true}return false},this)};k.prototype._generateRequireRequisites=function(){var r=this._augmentGrammar(this.startSymbol,this.startSymbol);g.utils.obj.each(this.rules,function(t,s){t.index=s});this._indexRulesByHead();r=this._cleanUnProductiveRules()||r;this._indexRulesByHead();this._cleanUnReachableRules(r);this._indexRulesByHead();this._removeMiddleTailEpsilons();this._determineNullableNonTerminals();this.terminals=this._generateListOfTerminals();this.firstSetsByHeader=this._precalculateFirstTerminals()};k.prototype._indexRulesByHead=function(){this.rulesByHeader=g.utils.obj.groupBy(this.rules,function(r){return r.head.name})};k.prototype._precalculateFirstTerminals=function(){var r={};g.utils.obj.each(g.utils.obj.keys(this.rulesByHeader),function(s){r[s]=this._calculateFirstSetForHead(s)},this);return r};k.prototype._calculateFirstSetForHead=function(t,s){var r=[];s=s||{};g.utils.obj.each(this.rulesByHeader[t],function(u){g.utils.obj.find(u.tail,function(v){if(v instanceof b){if(s[v.name]){return !v.isNullable}s[v.name]=true}else{if(v.isSpecial&&v.name===f.EOF){return true}}if(v instanceof d||(v.name===f.EMPTY&&v.isSpecial)){r.push(v)}else{if(v instanceof b){r=r.concat(g.utils.obj.flatten(this._calculateFirstSetForHead(v.name,s),true))}else{throw new Error("Impossible to calculate FIRST Set, some rules have invalid tail symbols")}}return !g.utils.obj.find(r,function(w){return w.name===f.EMPTY})},this)},this);return g.utils.obj.uniq(r,false,function(u){return u.name})};k.prototype._augmentGrammar=function(r,t){this.specifiedStartSymbol=t;var s=new c({head:"S'",tail:[r,new g.data.Symbol({name:f.EOF,isSpecial:true})],name:k.constants.AugmentedRuleName});this.rules.unshift(s);this.startSymbol=s.head;return s};k.prototype._cleanUnProductiveRules=function(){var t=false,s=0,r;do{t=false;g.utils.obj.each(this.rules,function(u){if(!u.isProductive){u.isProductive=this._isRuleProductive(u);t=t||u.isProductive}},this)}while(t);if(!this.preserveNonProductiveRules){while(s<this.rules.length){if(!this.rules[s].isProductive){this.rules.splice(s,1)}else{s++}}if(this.rules.length===0){r=this._augmentGrammar(new g.data.Symbol({name:f.EMPTY,isSpecial:true}),this.specifiedStartSymbol);r.index=0}}return r};k.prototype._removeMiddleTailEpsilons=function(){var r=0;g.utils.obj.each(this.rules,function(s){r=0;while(r<s.tail.length){if(s.tail[r].isSpecial&&s.tail[r].name===g.data.specialSymbol.EMPTY){if(((r+1)<s.tail.length&&(!s.tail[r+1].isSpecial||s.tail[r+1].name!==f.EOF))||(r===(s.tail.length-1)&&r>0&&!s.tail[r-1].isSpecial)){s.tail.splice(r,1);--r}}r++}})};k.prototype._cleanUnReachableRules=function(r){var t=false,s=0;r.isReachable=true;do{t=false;g.utils.obj.each(this.rules,function(u){if(u.isReachable){g.utils.obj.each(u.tail,function(v){if(v instanceof b){g.utils.obj.each(this.rulesByHeader[v.name],function(w){if(!w.isReachable){t=true;w.isReachable=true}})}},this)}},this)}while(t);if(!this.preserveUnReachableRules){s=0;while(s<this.rules.length){if(!this.rules[s].isReachable){this.rules.splice(s,1)}else{s++}}}};k.prototype._generateListOfTerminals=function(){var r=g.utils.obj.flatten(g.utils.obj.map(this.rules,function(s){return s.tail}),false);return g.utils.obj.filter(g.utils.obj.uniq(r,false,function(s){return s.name}),function(s){return s.isTerminal})};k.prototype._determineNullableNonTerminals=function(){var s=false,u=false;do{u=false;g.utils.obj.each(this.rules,function(v){if(v.tail.length===1&&v.tail[0].name===g.data.specialSymbol.EMPTY&&!v.head.isNullable){v.head.isNullable=true;u=true;this.nullableNonTerminals.push(v.head.name)}else{if(v.terminalsCount===0){s=g.utils.obj.every(v.tail,function(w){return this.nullableNonTerminals.indexOf(w.name)>=0},this);if(s&&!v.head.isNullable){v.head.isNullable=true;u=true;this.nullableNonTerminals.push(v.head.name)}}}},this)}while(u);var t=g.utils.obj.flatten(g.utils.obj.map(this.rules,function(v){return v.tail.concat(v.head)}),false);var r=g.utils.obj.filter(t,function(v){return v instanceof b&&this.nullableNonTerminals.indexOf(v.name)>=0},this);g.utils.obj.each(r,function(v){v.isNullable=true})};k.prototype.getRulesFromNonTerminal=function(r){return this.rulesByHeader[r.name]};k.prototype.toString=function(){var r=this.name?"Name: "+this.name+"\n":"";r+="Start Symbol: "+this.startSymbol.name+"\n";r+=g.utils.obj.reduce(g.utils.obj.sortBy(this.rules,function(s){return s.index}),function(s,t){return s+"\n"+t.index+". "+t.toString()},"");return r};return k})();g.data.ASTNode=(function(q){g.utils.obj.inherit(k,q);function k(r){q.apply(this,arguments);g.utils.obj.defineProperty(this,"rule");g.utils.obj.defineProperty(this,"stringValue");g.utils.obj.defineProperty(this,"currentValue");g.utils.obj.defineProperty(this,"symbol")}k.prototype.toString=function(r){if(r&&!g.utils.obj.isUndefined(r.deep)){r.deep=g.utils.obj.isNumber(r.deep)?r.deep:0;var s=g.utils.str.tabs(r.deep);++r.deep;return s+this._toCurrentString()+"\n"+g.utils.obj.reduce(this.nodes,function(u,t){return u+(g.utils.obj.isString(t)?g.utils.str.tabs(r.deep)+t+"\n":t.toString({deep:r.deep}))},"")}return this._toCurrentString()};k.prototype._toCurrentString=function(){return this.getIdentity()+(this.rule?": "+this.rule.toString()+" ("+this.currentValue+")":"")};return k})(g.data.Node);var h=g.data.ItemRule=(function(){var q={dotLocationIncrement:0};var k=function(r){this.options=r;g.utils.obj.defineProperty(this,"rule");g.utils.obj.defineProperty(this,"dotLocation");g.utils.obj.defineProperty(this,"lookAhead");g.utils.obj.defineProperty(this,"_id");this.lookAhead=this.lookAhead||[];this.dotLocation=r.dotLocation||0;if(this.rule&&this.rule.tail.length===1&&this.rule.tail[0].name===g.data.specialSymbol.EMPTY){this.dotLocation=1}};k.prototype.toString=function(){var r=this.getIdentity()+".  "+this.rule.head.name+"-->";for(var s=0;s<this.rule.tail.length;s++){r+=(this.dotLocation===s?"*":" ")+this.rule.tail[s].toString()}if(this.dotLocation===s){r+="*"}r+=",    ["+this.lookAhead.join(", ")+"]";return r};k.prototype.clone=function(t,s){var u=g.utils.obj.extendInNew(q,t||{}),v=this._cloneCurrentOptions(t,s);var r=new h(v);r._incrementDotLocation(u.dotLocationIncrement);r._id=null;return r};k.prototype._cloneCurrentOptions=function(s,u){var v=this.rule,t=this.lookAhead;this.rule=this.lookAhead=null;var r=g.utils.obj.extendInNew(this.options,u||{});this.rule=r.rule=v;this.lookAhead=t;r.lookAhead=[].concat(t);return r};k.prototype._incrementDotLocation=function(s){var r=g.utils.obj.isNumber(this.options.dotLocation)?this.options.dotLocation:0,t=g.utils.obj.isNumber(s)?s:1;this.dotLocation=r+t};k.prototype.getIdentity=function(){if(!this._id){this._id=this._generateIdentity()}return this._id};k.prototype._generateIdentity=function(){return this.rule.index+"("+this.dotLocation+")"};k.prototype.getCurrentSymbol=function(){return this.dotLocation<(this.rule.tail.length+1)?this.rule.tail[this.dotLocation]:null};k.prototype.isReduce=function(){return this.dotLocation===this.rule.tail.length};k.newFromRules=function(s,r){return g.utils.obj.reduce(s,function(t,u){t.push(new h({rule:u,dotLocation:0,lookAhead:[].concat(r||[])}));return t},[])};return k})();g.data.StackItem=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"state");g.utils.obj.defineProperty(this,"currentValue");g.utils.obj.defineProperty(this,"stringValue");g.utils.obj.defineProperty(this,"symbol");g.utils.obj.defineProperty(this,"AST");if(!this.state){throw new Error("Invalid initialization values for a Stack Item, please provide a valid state")}};return k})();g.data.State=(function(k){g.utils.obj.inherit(q,k);function q(r){k.apply(this,arguments);g.utils.obj.defineProperty(this,"isAcceptanceState");g.utils.obj.defineProperty(this,"_items");g.utils.obj.defineProperty(this,"_registerItems");g.utils.obj.defineProperty(this,"_condencedView");g.utils.obj.defineProperty(this,"_unprocessedItems");this.isAcceptanceState=false;this._items=r.items||[];this._unprocessedItems=this._items.length?g.utils.obj.shallowClone(this._items):[];r.items=null;this._registerItems={};this._registerItemRules()}q.prototype._registerItemRules=function(){g.utils.obj.each(this._items,function(r){this._registerItems[r.getIdentity()]=r},this)};q.constants={AcceptanceStateName:"AcceptanceState"};q.prototype.getNextItem=function(){return this._unprocessedItems.splice(0,1)[0]};q.prototype.addItems=function(r,s){this._id=null;g.utils.obj.each(r,function(t){if(!this._registerItems[t.getIdentity()]){this._registerItems[t.getIdentity()]=t;this._items.push(t);this._unprocessedItems.push(t)}else{if(!s||!s.notMergeLookAhead){var v=this._registerItems[t.getIdentity()];if(t.lookAhead&&t.lookAhead.length){v.lookAhead=v.lookAhead||[];t.lookAhead=t.lookAhead||[];var w=v.lookAhead.concat(t.lookAhead),u=this._registerItems[t.getIdentity()].lookAhead.length;this._registerItems[t.getIdentity()].lookAhead=g.utils.obj.uniq(w,function(y){return y.name});var x=g.utils.obj.filter(this._unprocessedItems,function(y){return y.getIdentity()===t.getIdentity()}).length>0;if(u!==this._registerItems[t.getIdentity()].lookAhead.length&&!x){this._unprocessedItems.push(t)}}}}},this)};q.prototype.toString=function(){var r="ID: "+this.getIdentity()+"\n"+this._items.join("\n")+"\nTRANSITIONS:\n";g.utils.obj.each(this.transitions,function(s){r+="*--"+s.symbol+"-->"+s.state.getIdentity()+"\n"});return r};q.prototype.getCondencedString=function(){if(!this._condencedView){this._condencedView=this._generateCondencedString()}return this._condencedView};q.prototype._generateCondencedString=function(){return g.utils.obj.map(g.utils.obj.sortBy(this._items,function(r){return r.rule.index}),function(r){return r.rule.index}).join("-")};q.prototype._generateIdentity=function(){if(this.isAcceptanceState){return q.constants.AcceptanceStateName}else{if(!this._items.length){return k.prototype._generateIdentity.apply(this,arguments)}}return g.utils.obj.reduce(g.utils.obj.sortBy(this._items,function(r){return r.rule.index}),function(s,r){return s+r.getIdentity()},"")};q.prototype.getItems=function(){return g.utils.obj.map(this._items,function(r){return r.clone()})};q.prototype.getOriginalItems=function(){return this._items};q.prototype.getOriginalItemById=function(r){return this._registerItems[r]};q.prototype.getSupportedTransitionSymbols=function(){var t={},r=[],s;g.utils.obj.each(this._items,function(u){s=u.getCurrentSymbol();if(s){if(t[s.name]){t[s.name].push(u)}else{t[s.name]=[u];r.push({symbol:s,items:t[s.name]})}}});return r};q.prototype._generateNewTransition=function(s,r){return{symbol:s,state:r}};q.prototype.getRecudeItems=function(){return g.utils.obj.filter(this._items,function(r){return r.isReduce()})};return q})(g.data.Node);g.data.Automata=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"states");g.utils.obj.defineProperty(this,"initialState");g.utils.obj.defineProperty(this,"hasLookAhead");g.utils.obj.defineProperty(this,"_index");g.utils.obj.defineProperty(this,"_unprocessedStates");g.utils.obj.defineProperty(this,"_registerStates");this.states=q.states||[];this._unprocessedStates=[];this._index=0;this._registerStates=g.utils.obj.groupBy(this.states,function(r){return r.getIdentity()});if(this.states.length){this._unprocessedStates=[].concat(this.states)}};k.prototype.toString=function(){return this.states.join("\n")};k.prototype.getNextState=function(){return this._unprocessedStates.splice(0,1)[0]};k.prototype.initialStateAccessor=function(q){if(!q){return this.initialState}this.initialState=q};k.prototype.addState=function(s){if(!this._registerStates[s.getIdentity()]){this._registerStates[s.getIdentity()]=s;this.states.push(s);this._unprocessedStates.push(s)}else{if(this.hasLookAhead){var q=this._registerStates[s.getIdentity()],r=false;g.utils.obj.each(q.getOriginalItems(),function(v){var w=s.getOriginalItemById(v.getIdentity()),u=v.lookAhead.length;v.lookAhead=g.utils.obj.uniq(v.lookAhead.concat(w.lookAhead),function(x){return x.name});if(!r&&u!==v.lookAhead.length){r=true}});if(r){var t=g.utils.obj.find(this._unprocessedStates,function(u){return q.getIdentity()===u.getIdentity()});if(!t){this._unprocessedStates.push(q)}}}}return this._registerStates[s.getIdentity()]};return k})();g.lexer.Lexer=(function(){var k={notIgnoreSpaces:false};var q=function(r){this.options=g.utils.obj.extendInNew(k,r||{});g.utils.obj.defineProperty(this,"grammar");g.utils.obj.defineProperty(this,"stream");g.utils.obj.defineProperty(this,"inputStream");g.utils.obj.defineProperty(this,"notIgnoreSpaces");g.utils.obj.defineProperty(this,"notIgnoreNewLines");g.utils.obj.defineProperty(this,"usePriorities");g.utils.obj.defineProperty(this,"useMultipleMatching");g.utils.obj.defineProperty(this,"_line");g.utils.obj.defineProperty(this,"_character");g.utils.obj.defineProperty(this,"_ignoredString");this.setStream(this.stream)};q.prototype.setStream=function(r){this.inputStream=this.stream=r;this._line=0;this._character=0;this._ignoredString="";this._clearStream()};q.prototype._clearStream=function(){if(g.utils.obj.isUndefined(this.inputStream)){this.inputStream=null}else{if(!this.notIgnoreSpaces||!this.notIgnoreNewLines){var r=this.inputStream;if(!this.notIgnoreSpaces&&!this.notIgnoreNewLines){this.inputStream=g.utils.str.fullLtrim(this.inputStream)}else{if(!this.notIgnoreSpaces){this.inputStream=g.utils.str.ltrim(this.inputStream)}else{if(!this.notIgnoreNewLines){this.inputStream=g.utils.str.ltrimBreaks(this.inputStream)}}}this._ignoredString=r.substr(0,r.indexOf(this.inputStream));this._updatePosition(this._ignoredString);if(this.inputStream===""){this.inputStream=null}}}};q.prototype._getErrorResult=function(){return{length:-1,string:this.inputStream,error:"NOT MATCHING FOUND",line:this._line,character:this._character}};q.prototype._updatePosition=function(s){if(!s){return}var r=g.utils.str.getIndicesOf("\n",s);if(r.length){this._line+=r.length;this._character=s.substr(g.utils.obj.max(r)+1).length}else{this._character+=s.length}};q.prototype._chooseMoreSpecifcToken=function(r,t,s){if(this.useMultipleMatching){return this._chooseMoreSpecificArrayTokens(r,t,s)}else{return this._chooseMoreSpecifcSingleToken(r,t,s)}};q.prototype._chooseMoreSpecificArrayTokens=function(s,u,t){var r=g.utils.obj.isArray(s)?s:[];r.push({length:u.length,string:u,line:this._line,character:this._character,terminal:t});if(this.usePriorities){r=g.utils.obj.sortBy(r,function(v){return -(v.terminal.priority||0)})}return r};q.prototype._chooseMoreSpecifcSingleToken=function(r,t,s){if(r.length<0||!r.terminal){return{length:t.length,string:t,line:this._line,character:this._character,terminal:s}}if(this.usePriorities&&s.priority>r.terminal.priority){return{length:t.length,string:t,line:this._line,character:this._character,terminal:s}}else{if(r.length<t.length){return{length:t.length,string:t,line:this._line,character:this._character,terminal:s}}return r}};q.prototype._searchNextToken=function(){var s=this.useMultipleMatching?[]:{length:-1},r;g.utils.obj.each(this.grammar.terminals,function(u){r=u.body;if(r instanceof RegExp&&!this.inputStream.search(r)){var t=r.exec(this.inputStream)[0];s=this._chooseMoreSpecifcToken(s,t,u)}else{if(g.utils.obj.isString(r)&&g.utils.str.startsWith(this.inputStream,r)){s=this._chooseMoreSpecifcToken(s,r,u)}}},this);return s};q.prototype._filterAndCleanResult=function(r,t){var s={};if(this.useMultipleMatching){s=this._filterAndCleanMultiMatchingResults(r,t)}else{s=this._filterAndCleanSingleResult(r)}if(s.length===-1){s=this._getErrorResult()}else{this._updatePosition(s.string);s.line=this._line;s.character=this._character;s.ignoredString=this._ignoredString;this.inputStream=this.inputStream.substr(s.length);this._clearStream()}return s};q.prototype._filterAndCleanSingleResult=function(r){return r};q.prototype._filterAndCleanMultiMatchingResults=function(r,s){var t=g.utils.obj.find(r,function(u){return g.utils.obj.contains(s,u.terminal.name)});return t||{length:-1}};q.prototype.getNext=function(t){var r={length:-1},s;if(this.inputStream===null){r={length:-1,line:this._line,character:this._character,terminal:new g.data.Symbol({name:g.data.specialSymbol.EOF})}}else{if(this.inputStream===""){s=s||g.utils.obj.find(this.grammar.rules,function(u){return u.tail.length===1&&u.tail[0].isSpecial&&u.tail[0].name===g.data.specialSymbol.EMPTY});if(s){r={length:0,string:"",line:this._line,character:this._character,terminal:new g.data.Symbol({name:g.data.specialSymbol.EMPTY})};this.inputStream=null}else{r=this._getErrorResult()}}else{r=this._searchNextToken();r=this._filterAndCleanResult(r,t)}}return r};return q})();var m=g.parser.tableAction={SHIFT:"SHIFT",REDUCE:"REDUCE",ERROR:"ERROR",ACCEPT:"ACCEPT"};g.parser.AutomataLRGeneratorBase=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"grammar");if(!(this.grammar instanceof g.data.Grammar)){throw new Error("In order to create a new Automata Generator please provide a grammar!")}};k.prototype.expandItem=function(r){var s,q=r.getNextItem();while(q){s=q.getCurrentSymbol();if(s instanceof g.data.NonTerminal){r.addItems(this._newItemRulesForStateExpansion(q,s),this._getExpansionItemNewItemsOptions())}q=r.getNextItem()}return r};k.prototype._getExpansionItemNewItemsOptions=function(){return{}};k.prototype._newItemRulesForStateExpansion=function(q,r){};k.prototype.generateAutomata=function(r){var s={notValidate:false,conflictResolvers:[]};r=g.utils.obj.extendInNew(s,r||{});var q=this._generateAutomata();if(!r.notValidate&&!this.isAutomataValid(q,r)){return false}return q};k.prototype.isAutomataValid=function(q,r){var s={automata:q};r=g.utils.obj.extend(s,r||{});return !g.utils.obj.any(q.states,function(t){return !this.isStateValid(t,r)},this)};k.prototype.isStateValid=function(r,q){};k.prototype._getConflictResolvers=function(){};k.prototype._generateAutomata=function(){var q=new g.data.State({items:this._getInitialStateItemRules()}),r=new g.data.Automata(this._getNewAutomataOptions(q));r.initialStateAccessor(q);this._expandAutomata(r);return r};k.prototype._getNewAutomataOptions=function(q){return{states:[this.expandItem(q)]}};k.prototype._getInitialStateItemRules=function(){};k.prototype._expandAutomata=function(q){var r=q.getNextState();while(r){var u=r.getSupportedTransitionSymbols(),t,s=[];g.utils.obj.each(u,function(v){g.utils.obj.each(v.items,function(x){s.push(x.clone({dotLocationIncrement:1}))});var w=new g.data.State({items:s});this.expandItem(w,q);w.isAcceptanceState=!!(w.getOriginalItems().length===1&&w.getOriginalItems()[0].rule.name===g.data.Grammar.constants.AugmentedRuleName&&w.getOriginalItems()[0].dotLocation===2);t=q.addState(w);r.addTransition(v.symbol,t);s=[]},this);r=q.getNextState()}};k.prototype.generateGOTOTable=function(q){var r={};g.utils.obj.each(q.states,function(s){r[s.getIdentity()]={};g.utils.obj.each(s.transitions,function(t){r[s.getIdentity()][t.symbol.toString()]=t.state})});return r};k.prototype.generateACTIONTable=function(q,r){};return k})();g.parser.AutomataLR0Generator=(function(k){g.utils.obj.inherit(q,k);function q(r){k.apply(this,arguments)}q.prototype._newItemRulesForStateExpansion=function(r,s){return g.data.ItemRule.newFromRules(this.grammar.getRulesFromNonTerminal(s))};q.prototype._getNewAutomataOptions=function(){var r=k.prototype._getNewAutomataOptions.apply(this,arguments);r.hasLookAhead=false;return r};q.prototype._getInitialStateItemRules=function(){return[new g.data.ItemRule({rule:this.grammar.getRulesFromNonTerminal(this.grammar.startSymbol)[0],lookAhead:[]})]};q.prototype.generateACTIONTable=function(r){var s={};g.utils.obj.each(r.states,function(u){var t=u.getItems();if(t.length===1&&t[0].dotLocation===(t[0].rule.tail.length)){if(u.isAcceptanceState){s[u.getIdentity()]={action:g.parser.tableAction.ACCEPT,rule:t[0].rule}}else{s[u.getIdentity()]={action:g.parser.tableAction.REDUCE,rule:t[0].rule}}}else{s[u.getIdentity()]={action:g.parser.tableAction.SHIFT}}});return(function(t){return function(v,u){return t[v]||{action:g.parser.tableAction.ERROR}}})(s)};q.prototype.isStateValid=function(s,r){r=g.utils.obj.isObject(r)?r:{};r.conflictResolvers=r.conflictResolvers||[];var t=s.getRecudeItems();return !(t.length!==s.getOriginalItems().length&&t.length>0||t.length>1)};return q})(g.parser.AutomataLRGeneratorBase);g.parser.AutomataLALR1Generator=(function(k){g.utils.obj.inherit(q,k);function q(r){k.apply(this,arguments)}q.prototype._newItemRulesForStateExpansion=function(s,t){var r=this._getFirstSet(s);return g.data.ItemRule.newFromRules(this.grammar.getRulesFromNonTerminal(t),r)};q.prototype._getFirstSet=function(r){var t=r.rule.tail.slice(r.dotLocation+1),s=[];if(t.length){g.utils.obj.find(t,function(u){if(u instanceof g.data.NonTerminal){s=s.concat(this.grammar.firstSetsByHeader[u.name]);s=g.utils.obj.uniq(s,false,function(v){return v.name});return !u.isNullable}else{if(u instanceof g.data.Terminal){s.push(u);return true}else{if(u.isSpecial&&u.name===g.data.specialSymbol.EOF){s.push(u);return true}else{throw new Error("Invalid Item Rule. Impossible calculate first set. Item Rule: "+r.toString())}}}},this)}else{s=r.lookAhead}return s};q.prototype._getNewAutomataOptions=function(){var r=k.prototype._getNewAutomataOptions.apply(this,arguments);r.hasLookAhead=true;return r};q.prototype._getInitialStateItemRules=function(){return[new g.data.ItemRule({rule:this.grammar.getRulesFromNonTerminal(this.grammar.startSymbol)[0],lookAhead:[new g.data.Symbol({name:g.data.specialSymbol.EOF,isSpecial:true})]})]};q.prototype.generateACTIONTable=function(r,s){var t={};g.utils.obj.each(r.states,function(w){t[w.getIdentity()]={};if(w.isAcceptanceState){t[w.getIdentity()][g.data.specialSymbol.EOF]={action:g.parser.tableAction.ACCEPT,rule:w.getOriginalItems()[0].rule}}else{var u={ignoreErrors:false,considerLookAhead:true};s=g.utils.obj.extendInNew(u,s||{});var v=this.getShiftReduceItemRuleFromState(w,s);if(!v){throw new Error("Impossible to generate Action Table. The following state is invalid. State: "+w.getIdentity())}g.utils.obj.each(v.shiftItems,function(x){t[w.getIdentity()][x.getCurrentSymbol().name]={action:g.parser.tableAction.SHIFT}});g.utils.obj.each(v.reduceItems,function(x){g.utils.obj.each(x.lookAhead,function(y){t[w.getIdentity()][y.name]={action:g.parser.tableAction.REDUCE,rule:x.rule}})})}},this);return t};q.prototype.isStateValid=function(s,z){z=g.utils.obj.isObject(z)?z:{};z.conflictResolvers=z.conflictResolvers||[];var r=s.getRecudeItems(),u=false;var w=g.utils.obj.filter(s.getOriginalItems(),function(A){return !A.isReduce()});if(w.length&&r.length){var v=g.utils.obj.sortBy(g.utils.obj.filter(z.conflictResolvers,function(A){return A.type===g.parser.conflictResolverType.STATE_SHIFTREDUCE}),"order");var y=g.utils.obj.any(w,function(B){var A=B.getCurrentSymbol();return g.utils.obj.find(r,function(C){var D=g.utils.obj.find(C.lookAhead,function(E){return E.name===A.name});if(D){u=g.utils.obj.find(v,function(E){return E.resolve(z.automata,s,B,C)});return !u}return false})});if(y){return false}}if(r.length>1){var x=g.utils.obj.sortBy(g.utils.obj.filter(z.conflictResolvers,function(A){return A.type===g.parser.conflictResolverType.STATE_REDUCEREDUCE}),"order");var t=g.utils.obj.any(r,function(A){return g.utils.obj.find(r,function(C){if(C.getIdentity()===A.getIdentity()){return false}var B=g.utils.obj.find(A.lookAhead,function(D){return g.utils.obj.find(C.lookAhead,function(E){return E.name===D.name})});if(B){u=g.utils.obj.find(x,function(D){return D.resolve(z.automata,s,A,C)});return !u}return false})});if(t){return false}}return true};q.prototype.getShiftReduceItemRuleFromState=function(s,A){A=g.utils.obj.isObject(A)?A:{};A.conflictResolvers=A.conflictResolvers||[];var r=s.getRecudeItems(),x=g.utils.obj.filter(s.getOriginalItems(),function(C){return !C.isReduce()}),u=!!A.ignoreErrors,B={shiftItems:[],reduceItems:[]},v=false;r=g.utils.obj.map(r,function(C){return C.clone()});if(x.length){var w=g.utils.obj.sortBy(g.utils.obj.filter(A.conflictResolvers,function(C){return C.type===g.parser.conflictResolverType.STATE_SHIFTREDUCE}),"order");var z=g.utils.obj.any(x,function(E){var D=E.getCurrentSymbol();var C=g.utils.obj.find(r,function(G){var H=g.utils.obj.find(G.lookAhead,function(J){return J.name===D.name});if(H){var I;v=g.utils.obj.find(w,function(J){I=J.resolve(A.automata,s,E,G);return I});if(v&&I.action===g.parser.tableAction.SHIFT){var F=g.utils.obj.indexOf(G.lookAhead,H);G.lookAhead.splice(F,1)}return !v}return false});if(!C||u){B.shiftItems.push(E);return false}return true});if(z){return false}}if(r.length){var y=g.utils.obj.sortBy(g.utils.obj.filter(A.conflictResolvers,function(C){return C.type===g.parser.conflictResolverType.STATE_REDUCEREDUCE}),"order");var t=g.utils.obj.any(r,function(D){var C=g.utils.obj.find(r,function(F){if(F.getIdentity()===D.getIdentity()){return false}var E=g.utils.obj.find(D.lookAhead,function(G){return g.utils.obj.find(F.lookAhead,function(H){return H.name===G.name})});if(E){v=g.utils.obj.find(y,function(G){return G.resolve(A.automata,s,D,F)});return !v}return false});if(!C||u){B.reduceItems.push(D);return false}return true});if(t){return false}}return B};return q})(g.parser.AutomataLRGeneratorBase);var o=g.parser.conflictResolverType={STATE_SHIFTREDUCE:"STATE_SHIFTREDUCE",STATE_REDUCEREDUCE:"STATE_REDUCEREDUCE"};var l=g.parser.ConflictResolver=(function(){var k=function(q){this.options=q||{};g.utils.obj.defineProperty(this,"name");g.utils.obj.defineProperty(this,"type");g.utils.obj.defineProperty(this,"order");g.utils.obj.defineProperty(this,"resolveFnc");this.type=this.type||o.STATE_SHIFTREDUCE;this.order=this.order||9999};k.prototype.resolve=function(r,s,q,t){return g.utils.obj.isFunction(this.resolveFnc)?this.resolveFnc(r,s,q,t):false};k.getDefaultResolvers=function(){return[new l({name:"precedence_resolver",type:o.STATE_SHIFTREDUCE,order:10,resolveFnc:function(q,s,r,t){if(!g.utils.obj.isNumber(r.rule.precendence)&&!g.utils.obj.isNumber(t.rule.precendence)){return false}r.rule.precendence=g.utils.obj.isNumber(r.rule.precendence)?r.rule.precendence:0;t.rule.precendence=g.utils.obj.isNumber(t.rule.precendence)?t.rule.precendence:0;if(r.rule.precendence>t.rule.precendence){return{itemRule:r,action:g.parser.tableAction.SHIFT}}else{if(r.rule.precendence<t.rule.precendence){return{itemRule:t,action:g.parser.tableAction.REDUCE}}}return false}}),new l({name:"associativity_resolver",type:o.STATE_SHIFTREDUCE,order:20,resolveFnc:function(q,s,r,u){var t=r.getCurrentSymbol();if(t.assoc===g.data.associativity.RIGHT){return{action:g.parser.tableAction.SHIFT,itemRule:r}}else{if(t.assoc===g.data.associativity.LEFT){return{action:g.parser.tableAction.REDUCE,itemRule:u}}}return false}})]};return k})();var a=g.parser.errorType={LEXER_NOTOKEN:"LEXER_NOTOKEN",PARSER_NOCONTINUATION:"PARSE_NOCONTINUATION",PARSER_NOMOVEMENT:"PARSER_NOMOVEMENT"};var e=g.parser.Parser=(function(){var k=function(q){this.options=q;g.utils.obj.defineProperty(this,"gotoTable");g.utils.obj.defineProperty(this,"actionTable");g.utils.obj.defineProperty(this,"initialState");g.utils.obj.defineProperty(this,"actionTableFn");g.utils.obj.defineProperty(this,"stack");g.utils.obj.defineProperty(this,"currentToken");if(!this.gotoTable){throw new Error("Invalid initialization values for a Parser, please provide a GOTO Table")}if(!this.actionTable){throw new Error("Invalid initialization values for a Parser, please provide a Action Table")}else{this.actionTableFn=this._getActionTableFunction(this.actionTable)}if(!this.initialState){throw new Error("Invalid initialization values for a Parser, please provide a Initial State")}this.stack=this.stack||[]};k.prototype._getActionTableFunction=function(q){return(function(r){return function(t,s){return(r[t]&&s&&s.name&&r[t][s.name])||{action:g.parser.tableAction.ERROR}}})(q)};k.prototype.parse=function(r){var q=new g.data.StackItem({state:this.initialState});this.currentToken=r.getNext(this._getExpectedLookAhead(this.initialState.getIdentity()));if(this.currentToken.error){return{error:true,type:g.parser.errorType.LEXER_NOTOKEN,description:"Invalid string to token. There were no valid next token",line:this.currentToken.line,character:this.currentToken.character,extra:this.currentToken}}this.stack.push(q);return this._parse(r)};k.prototype._parse=function(t){var r,q,s=this.stack[this.stack.length-1];do{q=this.actionTableFn(s.state.getIdentity(),this.currentToken.terminal);if(q.action===g.parser.tableAction.ERROR){return{error:true,type:g.parser.errorType.PARSER_NOCONTINUATION,description:"Invalid lookAhead. The current state does not allow the current lookAhead",line:this.currentToken.line,character:this.currentToken.character,extra:{terminal:this.currentToken.terminal,string:this.currentToken.string,validLookAhead:this._getExpectedLookAhead(s.state.getIdentity())}}}else{if(q.action===g.parser.tableAction.SHIFT){s.symbol=this.currentToken.terminal;s.currentValue=this.currentToken.string;s.stringValue=this.currentToken.string;s.ignoredString=this.currentToken.ignoredString}else{if(q.action===g.parser.tableAction.REDUCE){s=this._reduce(q)}else{if(q.action===g.parser.tableAction.ACCEPT){s=this._reduce(q);return s.AST.nodes[0]}}}}r=this.gotoTable[s.state.getIdentity()][s.symbol];if(!r){return{error:true,type:g.parser.errorType.PARSER_NOMOVEMENT,description:"Invalid state to go. The is no valid next state",line:this.currentToken.line,character:this.currentToken.character,extra:{lastState:s.state.getIdentity(),lastSymbol:s.symbol}}}this.stack.push(new g.data.StackItem({state:r}));s=this.stack[this.stack.length-1];if(q.action===g.parser.tableAction.SHIFT){this.currentToken=t.getNext(this._getExpectedLookAhead(s.state.getIdentity()));if(this.currentToken.error){return{error:true,type:g.parser.errorType.LEXER_NOTOKEN,description:"Invalid string to token. There is no valid next token",line:this.currentToken.line,character:this.currentToken.character,extra:this.currentToken}}}}while(true)};k.prototype._getExpectedLookAhead=function(q){return g.utils.obj.keys(this.actionTable[q])};k.prototype._reduce=function(q){var x={},r,v,u,w=q.rule,s=w.tail.length===1&&w.tail[0].name===g.data.specialSymbol.EMPTY,t=this.stack[this.stack.length-1];u=s?[]:this.stack.slice(-1*(w.tail.length+1),this.stack.length-1);x.values=g.utils.obj.map(u,function(y){return y.currentValue});x.ignoredStrings=g.utils.obj.map(u,function(y){return y.ignoredString});x.stackRange=u;x.rule=w;this.stack=s?this.stack:this.stack.slice(0,-1*w.tail.length);t=this.stack[this.stack.length-1];t.symbol=w.head;t.currentValue=g.utils.obj.isFunction(w.reduceFunc)?w.reduceFunc.call(this,x):t.symbol;v=g.utils.obj.map(u,function(y){return y.AST||y.stringValue});r=new g.data.ASTNode({nodes:v,rule:w,symbol:w.head,stringValue:t.stringValue,currentValue:t.currentValue});t.AST=r;return t};return k})();var p=g.parser.parserCreator=(function(){var k=function(){};k.create=function(t){t=g.utils.obj.extend({},{automataGenerator:g.parser.AutomataLALR1Generator},t||{});var r=t.grammar,s=new t.automataGenerator({grammar:r}),q=s.generateAutomata({conflictResolvers:g.parser.ConflictResolver.getDefaultResolvers()}),w=s.generateGOTOTable(q),v=s.generateACTIONTable(q,{conflictResolvers:g.parser.ConflictResolver.getDefaultResolvers(),ignoreErrors:false}),u=new g.lexer.Lexer({grammar:r,stream:t.strInput,usePriorities:t.lexer&&t.lexer.usePriorities,useMultipleMatching:t.lexer&&t.lexer.useMultipleMatching}),x=new g.parser.Parser({gotoTable:w,actionTable:v,initialState:q.initialStateAccessor()});return{parser:x,lexer:u}};return k})();return g});